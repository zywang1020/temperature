<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Geo是炎值爆錶 🌞</title>
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #map { height: 400px; border-radius: 1rem; }
    .surface-img { width: 120px; border-radius: 12px; margin: 8px; }
  </style>
</head>
<body class="bg-gradient-to-r from-yellow-100 to-orange-200 text-gray-800">

  <header class="text-center py-6">
    <h1 class="text-3xl font-bold">Geo是炎值爆錶 🌍🔥</h1>
    <p class="mt-2">依據所在地最近氣象站，計算不同鋪面的實際體感溫度</p>
  </header>

  <main class="max-w-4xl mx-auto p-6 bg-white shadow-xl rounded-2xl">
    <!-- 日期選擇 -->
    <div class="mb-4">
      <label for="date" class="block mb-2 font-semibold">選擇日期：</label>
      <input type="date" id="date" class="p-2 border rounded-lg w-full">
    </div>

    <!-- 地圖 -->
    <div id="map" class="mb-6"></div>

    <!-- 天氣資訊 -->
    <div id="weather" class="p-4 bg-gray-100 rounded-lg shadow-inner mb-6">
      📍 目前位置：<span id="location">定位中...</span><br>
      🌡️ 最近氣象站：<span id="station">查詢中...</span><br>
      🌤️ 氣溫：<span id="temp">--</span> °C
    </div>

    <!-- 鋪面溫度顯示 -->
    <h2 class="text-xl font-bold mb-3">不同鋪面溫度模擬 🌡️</h2>
    <div id="surfaces" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center"></div>
  </main>

  <footer class="text-center py-6 text-sm text-gray-600">
    © 2025 Geo是炎值爆錶 | 製作：正毅
  </footer>

  <script>
    // === 預設的氣象站資料（僅示範部分，可自行擴充） ===
    const stations = [
      { name: "台北", lat: 25.0375, lon: 121.5637, temp: 31 },
      { name: "台中", lat: 24.1477, lon: 120.6736, temp: 30 },
      { name: "高雄", lat: 22.6273, lon: 120.3014, temp: 32 }
    ];

    // 反照率資料
    const albedoData = [
      { surface: "柏油路", albedo: 0.05, img: "https://i.imgur.com/NYa9YcF.jpg" },
      { surface: "草地", albedo: 0.25, img: "https://i.imgur.com/XM0DlFm.jpg" },
      { surface: "混凝土", albedo: 0.15, img: "https://i.imgur.com/rf7mOQT.jpg" },
      { surface: "白色屋頂", albedo: 0.65, img: "https://i.imgur.com/w5CBHZz.jpg" }
    ];

    // 初始化地圖
    const map = L.map('map').setView([23.7, 121], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // 取得使用者定位
    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      document.getElementById("location").innerText = `${lat.toFixed(3)}, ${lon.toFixed(3)}`;
      map.setView([lat, lon], 10);

      // 找最近的氣象站
      let nearest = null, minDist = Infinity;
      stations.forEach(st => {
        const d = Math.sqrt(Math.pow(lat - st.lat, 2) + Math.pow(lon - st.lon, 2));
        if (d < minDist) {
          minDist = d;
          nearest = st;
        }
      });

      if (nearest) {
        document.getElementById("station").innerText = nearest.name;
        document.getElementById("temp").innerText = nearest.temp;

        // 顯示不同鋪面的模擬溫度
        const baseTemp = nearest.temp;
        const container = document.getElementById("surfaces");
        container.innerHTML = "";
        albedoData.forEach(s => {
          // 簡化公式: 鋪面溫度 = 基礎氣溫 + (1 - albedo) * 10
          const surfaceTemp = (baseTemp + (1 - s.albedo) * 10).toFixed(1);
          container.innerHTML += `
            <div class="p-2 bg-gray-50 rounded-xl shadow">
              <img src="${s.img}" class="surface-img mx-auto">
              <p class="font-semibold">${s.surface}</p>
              <p class="text-lg text-red-600">${surfaceTemp} °C</p>
            </div>`;
        });
      }
    }, err => {
      document.getElementById("location").innerText = "定位失敗，請開啟GPS";
    });
  </script>
</body>
</html>
